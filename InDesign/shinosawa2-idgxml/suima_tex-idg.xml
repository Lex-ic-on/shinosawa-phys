<?xml version="1.0"?>
<aid:doc xmlns:aid="http://ns.adobe.com/AdobeInDesign/4.0/"><h1>第19章　てふてふ、綺麗だね <sub>`もうマイク入ってますよ、篠澤さん！！！'</sub></h1>
<h2>19.1　雑な導入</h2>
P`篠澤さん.'広プロデューサー? どうしたの?P`この前レポートを書いていたときに, TeXのエラーで苦労しまして.'広ふふ, よくあることだね. ……プロデューサーも理数系のレポートあるんだ.P`まあ仮にも大学生ですからね. 話を戻すと, 結局のところ平仮名がコマンド? の直後に入っていたことが問題でした.'広英語しか使わなければ良いのにP`残念ながら俺はそこまで博学多才ではありませんし, 俺の担当教員もそうすると困るでしょう.'広そうかも.P`にしても, TeXって他のプログラミング言語?とかと色々と違って癖が強いなぁと.'広プロデューサー, わたし, その話できるよ.P`でしょうね.'広プロデューサー, わたし, その話, できるよ.P(……やはりこういうところは理系の血ではあるのか.)広何か言った?P`いいえ. では教えていただけますか?'広ふっふっふ…… そう頼まれては仕方ない. この広先生が教えてあげよう, といいたいところ. だけど, 今から話すとこの後のトレーニングがなくなることになる.P`つまり結構時間がかかるんですね.'広そういうこと. 日を改めて広先生のところに教わりに来るといい.<h2>19.2　TeXについて</h2>
<p align="center">～後日～</p>
広では, これから広先生の講義を始める. P`よろしくお願いします. 篠澤先生.'広……むぅ. まあいいや. プロデューサーはTeXについてどれくらい知ってる?P`論文とかレポートを書くときに時折指定されるから使わざるを得ないもの, でしょうか?'広正直でいいね. でもそれだと困る.P`では何なんですか?'広わたしもよく分からない(どや)P`……'広というのは, 半分ほんとう. TeXと単純に言っても, 何を指しているのか実ははっきりしない.P`篠澤さんが悪ふざけをしたわけではないんですね.'広流石に自分からやり始めたときにプロデューサーの反応を見ようだなんてしない, よ. …… たぶんP`……'広閑話休題. こんなことになっているのは, TeXに関連するものを全部TeXと言っているからだと思う.P`といいますと?'広TeXと呼んだときに意味するものは主に次の四つ. TeX言語, TeXエンジン, LaTeX, そして, TeXのソース.P`何が違うんですか?'広全然違う. ミートソーススパゲッティについて, スパゲッティのレシピと, スパゲッティのメーカーと, ミートソースと, 盛り付けくらい違う.P(今度作るか……)P`では, 今回は何を教えてくれるんですか?'広全部P`…… はい?'広全部, だよ.P`それは篠澤さんの体力が保たないのでは'広うーん, それもそう. あまり他では聞けない話だけにする.P`他では聞けない話, ですか.'広そう. まずはTeX自体について.広そもそも, TeXの開発者は誰かしってる？P`知らないですね.'広D. E. Knuthだよ. P`すみません, どなたですか.'広巨大数クヌースの矢印表記, みんなは知ってる？とか, 他にも計算機科学計算量について, オーダー記法を使うことを定着させた立役者だね.とかの分野の権威だね. 今も毎年不定期に教鞭執ってるらしい, よ.あと, 上付き文字をサーカムフレックスで表す, っていうのもクヌース先生の発案だ, よ.(クヌースの矢印表記の略記として ^ を定めたのと, TeXの上付き文字が ^ でできた, っていうのが理由だけど, 今回はこのお話じゃないからまた今度, ね)P`なるほど, よくわからない.'広大きい数の表し方とかの研究とか, コンピュータがその問題を解くのにどれくらいの時間がかかるのか, とかの研究をしている人だよ.P`なるほど, 大雑把には理解できました.'広Knuthせんせいは, 実家が印刷所だったこともあって, 初期の電算写植の品質に満足できなくて, 自分で電算写植用のソフトウェアを開発しようと思ったんだって.P`すみません, 電算写植とはなんですか?'広コンピューターを使って文字の配置, つまり組版を行うことだ, よ.P`ああ, それなら理解できます.'広うん, それで, 当時のコンピュータは今みたいに映像処理が簡単にできるほど高いスペックじゃなかったから, Knuthせんせいは面白いことを考えた.P`と, いいますと?'広組版に特化したプログラミング言語と, フォントの作成に特化したプログラミング言語の二つを作った, よ.P`はい?'広今みたいに, GUIで処理ができる時代じゃなかったから, テキストだけで文字の配置とか, フォントのかたちを決めたい, ってなったときに, それ専用のプログラミング言語を作ろうと思ったんだって.広それが と.P`ふむ, 片方についてはもはや聞き覚えもありませんが.'広現代では基本的にMETAFONTをつかうことはない, よ. でも, Knuth先生がMETAFONTをつかってデザインした Computer Modern フォントは, かなり独特の美しさがある, よ. とってもコントラストが効いた良いフォント.P(…… 理数系のレポートで, デザインを気にしたことがなかったな……)広そして, これらはわたしがさっきプログラミング言語と言ったように, チューリング完全.P`すみません, チューリング完全とはなんですか?'広今回は本筋じゃないから, 軽くだけ説明する, ね.広簡単に言えば, コンピューターで出来る計算が, ひととおりできること, だよ.P`それは, コンピューター上で実行しているのだから, 当然では?'広全然違う. 例えば, 広って打ったら好きって表示して, それ以外は何もしないという, 言語があったとするP(どういう例だ)広これだと, 広って打ったときに好きって表示することしか出来ないから, コンピューターで出来る計算がひととおり出来るわけではない, でしょ.P`ああ, なんとなく分かりました. その言葉で表現できる範囲で, 計算が一通りできることが, チューリング完全. ということですね.'広そう.P`それは分かったんですが, それって重要なんですか?'広重要. このおかげで, TeXでは, いろいろなことを自動でやってもらうことができる, よ.この文書のオリジナルのソースも, 毎行初めにフックして処理をしている, ね. ふふ, わたし知ってるよ.広と, ここまでTeXの話をしてきたけど, 実はオリジナルのTeXには大きな問題がある.P`何でしょう.'広実は, ASCIIにしか対応していない. げんみつには, 入力がASCIIにしか対応していない, よ. 内部的には独自の文字コードを使ってる. これを読んでいる人にも, T1エンコードを強制しないといけないって, 呪文みたいに読んだことがある人が居るとおもう, よ.P`出版社でしょうか?'広それは日本ASCII, TeXの話をする上で重要な会社だけど, いまはそれのことじゃない, よ. 文字コードのこと.P`unicodeとかShift JISとかの仲間でしょうか?'広そう, 技術的にはunicodeのおとうさんにあたる. アルファベットと基礎的な記号を, 7bitで表現する, よ.P`7bitといいますと, で128個の文字しか表現できない, ということでしょうか?'広そうなるね. ほんとうは, 制御文字があるからもっと少ないけど, ねP`それじゃあ日本語は表現できないじゃないですか.'広ちっちっち……P`何か違うんですか?'広日本語はおろか, 純粋で, なにもついていないラテン・アルファベット以外をつかう言葉…… つまり, 英語以外表現できない, よ.P`ダメじゃないですか.'広ううん, 初期のコンピューターでの連絡でも, ASCIIは, 英語以外もちゃんと読める方法を用意してはいた, よ.結局, ヨーロッパだと, ASCIIを拡張した文字コードを幾つか定義したけど, ね.広でも, これはあくまで読める, であって, ちゃんとした普通の文字に出来たわけではなかった. けど, TeXはそのへんは解決した, よ.P`では日本語も表現できたんですか?'広頭ごなしには否定できない. NTT  っていうものがあって, これは, 内部的には日本語文字の入力を英字に対応させるんだけど, その後, 日本語文字に対応していた英字のフォントを切り替えることで, 日本語文字を表示する, という手法をとっていた, よ.広このNTT JTeXは, 技術的には殆ど改造を加えていない, これはあくまで組版とか, 内部コードの処理とかが, これ以外の日本語対応TeXに比べて変わってない, って意味で, JTeXが何もしていないって事ではない, よ「ほとんどTeX」だから, これを踏まえるなら, TeXは日本語に対応できた, となる.ほかにも, TeXマクロレベルでJTeXと似たことをして, 日本語組版をした人たちもいた，よ.P`ううむ……'広でも, オリジナルのTeXは, 日本語が出来た, とはしなくていいよ.広それに, 日本語に対応するように改変されたTeXで, 一般的になったものは, JTeXじゃなかった, よ.P`と, 言いますと?'広うん, このためには, TeXと, 改変されたTeXの関係を知っておいた方が, いい.広から, 用意してきた, よ.<Image href="file://images/suima_tex/fig1.pdf"/>
<img-caption>図19.1　TeXの派生</img-caption>
P`うわっ.'広今主流のTeXと, その派生の関係は, この図におさまる, よ.広因みに, 現在配布されているのは, この図の中だと, pdfTeXと, XeTeXと, LuaTeXと, e-upTeXだけだ, ね.P`軽くだけ説明してもらっても……?'広まかせて. まず, オリジナルのTeXはさっきも言ったようにプログラムができる. でもね, すごくめんどうくさい.広だから, その改善として が開発された.広一方, 日本では, 日本ASCII社によって,  が開発された, よ. これは, 日本語に積極的に対応させたもので, さっき一瞬話した よりも, おおきく中身を書き換えてる.広pTeXは, その後に文字コードがunicodeになった と, e-TeX 拡張に対応した の二つの派生が生まれて広最終的に, 今はその二つを合体させた が利用されている, よ.少なくとも, TeX live 2025ではptex,uptex,eptex,platexは全部e-upTeXのそれぞれの互換モードでの起動のためのリンクになってる, よ広欧米では, pdf出力に対応した と, 多言語に対応した双方向組版もできる, よ. だからロゴが左右対称が開発されて, pdfTeXからは, 更にプログラミング言語のLuaを利用できるようにした が生まれた, よ.P(あれ, そもそもTeXの出力ってpdfじゃないのか)広それで, ね. TeXは組版に特化したプログラミング言語だけど, これのまま組版をすることは難しいより正確には, 今では「素の」TeXで組版をすることは, 原理的に出来ない, よ. texを起動するときに, texと打ち込んだとしても, plain TeXで起動するし, 何もマクロパッケージを読み込まないためには, 今のTeXでは-ini オプションを使うしかないけど, iniTeX だと組版は出来ない,(組版のためのプリミティブが幾つか無視される)よ. 昔はvartexで素のTeXが起動できたらしいけど, 今はもうplain texで起動するみたい.広だから, L. B. Lamportという人が, LaTeX というものを開発した, よ.広これは, TeX上のマクロパッケージ…… TeXで書かれた, TeXのうごきかたを変更するためのもので, げんみつにはちょっと違うけど, この説明がわかりやすいと思う, よ.普通の人はLaTeX上で処理を行う, よ.P`と, いいますと?'広いまどき, Knuthせんせいが設定した「オリジナルのTeX組版」である, plain TeXを使う人はほとんどいなくて, 大体の人はLaTeX用のTeXコードを書いている, よ. わたしはConTeXtも良いと思うけど, 日本だと使ってる人すくないから, 今日はお話ししない, よ.著者注: 他にもTeXマクロは存在しますが, 今回は無視させていただきます. マイナーな奴は情報源少なすぎるんじゃP`なるほど.'広さて, このへんでTeXについてのお話はお終い. どうだった?P`中々ややこしいな, と思いました.'広ふふ, そんなプロデューサーに朗報. まだ話は終わりじゃない, よ.P`!?'<h2>19.3　TeXの周りについて</h2>
広そもそも, プロデューサーはTeXの出力形式については知ってる?P`pdf, でしょうか.'広プロデューサーの場合は, まちがい. 前にプロデューサーに訊かれたときについでに環境設定見ちゃった.P`どうしてこう, あなたという人は…… まあいいでしょう. “俺の場合”というのは, どういうことでしょうか?'広うん, そもそも, さっき話したように, TeXにはいろんな“変わり者”が居る. プロデューサーが使っているのは, の 互換モードだ, ね. 日本の論文ではよく使われるフォーマットだけど, 最近のLaTeX開発ではかなりおいてけぼりになってる, よ.P`と, 言いますと?'広まず, upLaTeXだと出力形式はpdfではないことについて, この問題は比較的シンプル.広単純に, upLaTeXの出力形式は, dvi, だよ.P`dviとは……? 端子の名前ですか?'広それはデジタル映像の伝送に使うやつだね. このdviは, DeVice Independent file formatの略だよ. P`なんですか, それは.'広デバイスに依存せずに, 文字とかの配置を記述するための, ファイルの種類だ, よ.P`ふむ……'広当時の電算写植用のプリンターが, そのデータを受け取ってじぶんで処理できるようにしたファイル, という言い方もあるね.P`ああ, 現代のプリンターのようにPDFとかPNGで処理が出来たわけではなかったということですね?'広だいたいそうだね. そもそもそれらの形式がなかったという話もあるけど, ね.広それで, このdvi形式については, 現代だと特に何の役にも立たない.P`そんな……'広だから, このdviを他の現代的なファイル形式に変換してあげる必要がある.広最初に出てきたのは, dvips 1992年だったかな. に作られたソフトウェアで, dviをPostScript形式に変換することができる.P`PostScript…… ああ, 時折見かけます. PDFの元になった形式ですよね?'広そう. プロデューサーはこの形式の弱点は知ってる?P`知らないですね.'広ランダムアクセス.. つまり, 1ページ目から, 次は100ページ目を読む, みたいなことに弱い, よ広初めから順繰りに読んでいかないと, 読み込めない形式なんだよ, ね.P`あ～…… プリントするならさておき, コンピュータ上で読むには不便ですね.'広そう, だから, dvipdfというツールが生まれた. これは技術的にはdvipsで一度dviをps形式にしてからpsをpdfに変換している. 今では手に入らないし, そもそも現在のLinuxにはps2pdfというものが搭載されているから必要もないけど, ね.広それで, この後, 直接pdf出力に対応したpdfTeXが開発されたんだけど, Mark A. Wicks氏はどうしてもKnuthオリジナルのTeXが使いたかったから, 自分でdviからpdfを直接出力するツールを開発した. これがdvipdfm 多分末尾のmはMark氏の名前か, mark機能を指しているんじゃないかな.P`ふむ…… でも, それならあまり一般的なソフトウェアにはならなさそうなものですが……'広dvipdfmが重要なのは, この後にCJK対応…… 日本語とか中国語に対応した拡張版が開発されたことにある, よ広このdvipdfmxは, pTeX系列でのワークフローに取り込まれて, 現代に至るまで使われている, よ.広つまり, プロデューサーもこれを利用している, よ.P`え, 俺はlatexmkとかいうのを利用していると記憶しているんですが……'広latexmkは, TeX…… 特にLaTeXは何回かコンパイルをする必要がある場合があるんだけど, その必要な回数だけのコンパイルを自動でしてくれるスクリプト. つまり, これがdvipdfmを呼び出すことでプロデューサーはpdf出力を得られている.P`なるほど'広それで, XeTeXはdvi自体を拡張したxdvファイルを出力するんだけど, このxdvをpdfに変換するのがxdvipdfmx…… dvipdfmxをxdvに対応するように改変したもの.広実は現代ではxdvipdfmxしか配布されていない, よP`そんな…… 俺は老人だったのか.'広プロデューサーの環境が古いわけじゃない, よ. xdvipdfmxはdvipdfmx互換モードとdvipdfm互換モードがあるから, それらの名前でも起動できる, よ.P`大体理解しました. じゃあ実際のフローは次のようになるわけですね'<Image href="file://images/suima_tex/fig2.pdf"/>
<img-caption>図19.2　TeXからpdfへの流れ</img-caption>
広そういうこと. よくできました, えらいえらい.P`……'<h2>19.4　TeX言語について</h2>
広それで, ここまで, TeXとか, TeXまわりの処理の流れを教えたけど.P`はい.'広ここからは, TeXの処理の話, ね.P`うっ.'広どうしたの?P`すごく, 嫌な予感がします.'広大丈夫だよ. Malbolgeよりはかんたん.P`それが何かは知りませんが, 多分ダンテの地獄の第八圏と関わるんでしょう. 何の安心感も与えてくれないんですが.'広お～ さすがプロデューサー. あってる, よ. すっごく読みにくいプログラミング言語だね. これよりは遙かに簡単に理解できる, よ.P(ため息をつく)広あっわたしの好きな目になったね.P`……'広大丈夫, 今回はそこまで難しい話はしない, よ. プロデューサー, そもそもプログラミングにそこまでは明るくないでしょ?P`まあ, Pythonをちょっと触ったことがある程度ですね.'広そんなプロデューサに朗報. TeXに関数はない, よ.P`えっ'広TeXにあるのはマクロとカウンタだけだ, よ.あとマクロの展開があるんだけど……P`マクロとカウンタだけ……? というか今小声で言っていた展開とは何ですか? '広あちゃー聞こえてしまったか. 訊かれてしまっては仕方がない, 説明しよう. P`……'広今回は, plain TeXでの\newifの定義を例に説明する, よ.<codelist-caption>リスト19.1　newifの定義(抜粋)</codelist-caption>
<codelist-pre><span type="lineno"> 1: </span>\catcode`\@=11
<span type="lineno"> 2: </span>\catcode`\{=1
<span type="lineno"> 3: </span>\catcode`\}=2
<span type="lineno"> 4: </span>\countdef\count@=255
<span type="lineno"> 5: </span>\countdef\m@ne=22
<span type="lineno"> 6: </span>\m@ne=-1
<span type="lineno"> 7: </span>\outer\def\newif#1{\count@\escapechar \escapechar\m@ne
<span type="lineno"> 8: </span>  \expandafter\expandafter\expandafter
<span type="lineno"> 9: </span>   \def\@if#1{true}{\let#1=\iftrue}
<span type="lineno">10: </span>  \expandafter\expandafter\expandafter
<span type="lineno">11: </span>   \def\@if#1{false}{\let#1=\iffalse}
<span type="lineno">12: </span>  \@if#1{false}\escapechar\count@}
<span type="lineno">13: </span>\def\@if#1#2{\csname\expandafter\if@\string#1#2\endcsname}
<span type="lineno">14: </span>{\uccode`1=`i \uccode`2=`f \uppercase{\gdef\if@12{}}}
</codelist-pre>P`う, うわぁあ……'広プロデューサーもそんな情けない声出すんだね. だいじょうぶ, わたしが全部教えてあげる, よ.広そもそも, TeXにはカテゴリーコードっていうものがある, よ.<caption>表19.1　カテゴリーコードの表</caption>
<table aid:table="table" aid:trows="17" aid:tcols="2">
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid:theader="1" aid5:cellstyle="headercell" aid:pstyle="tableheader">カテゴリーコード</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid:theader="1" aid5:cellstyle="headercell" aid:pstyle="tableheader">役割</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">0</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">制御綴の開始</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">1</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">グループの開始</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">2  </cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">グループの終了</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">3  </cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">数式・非数式の切り替え</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">4  </cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">アライメントの区切り</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">5  </cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">行の終了</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">6  </cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">パラメタ文字</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">7  </cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">上付き文字</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">8 </cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">下付き文字</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">9</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">無視</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">10</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">空白文字</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">11  </cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">英字</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">12  </cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">記号</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">13  </cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">アクティブ文字</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">14  </cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">コメントの開始</cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">15  </cell>
<cell xmlns:aid5="http://ns.adobe.com/AdobeInDesign/5.0/" aid:table="cell" aid:crows="1" aid:ccols="1" aid:ccolwidth="201.247" aid5:cellstyle="bodycell" aid:pstyle="tablebody">無効文字</cell>
</table>
P`う, うわぁぁぁ'広大丈夫, 今回は全部は説明しない, よ.広まずは, 制御綴コントロールシーケンスについて.広制御綴っていうのは, TeXに対して, その文字以上の意味を持って指示をするもの.P`すみません, よくイメージがわかないのですが……'広プロデューサー.P`はい?'広好きP`知っていますよ.'広えっ. ……そういうことじゃなくてね, いまプロデューサーは「好き」という単なる音ではなく, その「意味」を解釈して反応したでしょ. 制御綴もそういうこと.広たとえば, 普通にTeXに文章を打ち込んでもその文字がpdfに出力されるだけだけど, \textbackslashと打ち込むと, 表示されるのは\textbackslashではなくて, \でしょ?P`ああ, 理解しました…… 確かに“TeXに対して, その文字以上の意味を持って指示をするもの”ですね.'広制御綴をなすのは, 次の3つのパターン.広1つめはアクティブ文字1文字. 普通のLaTeXだと, ~ がそれにあたる. 広2つめは制御綴の開始文字と, 英字以外の1文字が, この順で並んでいるもの. 普通のLaTeXだと\, とかが挙げられる, よ.広3つめは制御綴の開始文字の後に, 英字が続く場合. この場合は, 英字以外が続きに来るまでが制御綴と見なされる.広このとき, 英字(カテゴリーコード11)は, “英字”を指すわけではない, よ. だから, プロデューサーが引っかかったように和字でも制御綴の一部と見做されることがある, よ.P`俺の出くわしたエラーにそんな裏話があるとは……'広つぎに, TeXのトークナイズについて, ほんの少しだけ説明をする.P`トークナイズとは……?'広トークナイズというのは, わたしたちがTeXコードを書いたときに, TeXがその意味を理解する上で, TeXにとって理解できるまとまりに分割していくこと, だと思って良い.P`そう言われても余りイメージが湧かないのですが.'広これについては説明をしていくと理解できるかもしれない. だから, 今から説明をしていく, よ.広まずは次のようなLaTeX用のソースコードを考える<codelist-caption>リスト19.2　LaTeXコードの例</codelist-caption>
<codelist-pre><span type="lineno"> 1: </span>\documentclass{article}
<span type="lineno"> 2: </span>\begin{document}
<span type="lineno"> 3: </span>This is \LaTeX document.
<span type="lineno"> 4: </span>\end{document}
</codelist-pre>広このソースコードを実行すると, <p><inlineequation><Image href="file://images/_review_math/_gen_147c3927c9a0573330dbb709e1136b0398500c6dc72d953d2ca7ffc6996184b4.pdf" type="inline"/></inlineequation></p>
広とだけ表示される, よ.P`あれ,  とdocumentの間にスペースは入らないんですか?'広それもいい質問. これからそれも答える.広TeXに限らないけど, 殆どのプログラミング言語はソースコードを頭から順に読んでいく, よ.広この例の場合, まずは\がある. \のカテゴリーコードは0だから, ここから制御綴が開始される.広次の文字はd. これのカテゴリーコードは11だから, さっき言ったパターン3の制御綴となる.P`英字が続く限り制御綴となるパターンですね.'広そう. こうして出来る制御綴は\documentclass. 簡単のために, オプション引数を無視すると, \documentclassは直後の一つの集まりを引数に持つマクロ.P`一つの集まりというと……?'広一つのトークンか, 一つのグループだ, よ.P`ますます分からない'広落ち着いて. トークンって言うのは, 制御綴か, 制御綴でない部分の1文字のこと. パターン3の直後の空白文字とかコメント開始文字から, 直後の改行文字までとかは普通のトークンにはならないけど, ね.P`つまり, トークナイズというのは, トークンに分割していく作業のことですか?'広そういうこと, よくできました. えらいえらい.P`……'広それで, ね. \documentclassの直後の文字はカテゴリーコード1の{だから, ここから一つのグループが始まる, よ. 広ここからカテゴリーコード2の}までの間にある文字はa,r,t,i,c,l,eだから, \documentclassにはarticleというトークン列が一つのものとして渡されることになる.P`なるほど.'広この次の\begin{document}も同様. この直後からがまた別のお話.広LaTeXの場合, \begin{document~\end{document}}の部分にある文字が最終的なPDFに出力される, よ. 実際には\begin{document}が\document, \end{document}が\enddocumentに展開される, とかのお話はあるけど, ね広だから, 今回の例だと 最初のT,h,i,sがまず出力される文字になる.広次に, Thisの直後のスペースも, 普通に出力される, よ.ここについても, スペースが2個以上続いても一つになる, とかがあるんだけど, ね.P`そりゃそうでしょう.'広うん. isの直後もおなじ. でも, 次の制御綴\LaTeXの後は別のお話.広制御綴直後の空白文字は, 空白として出力されない, よ. ここが出力されちゃうと, 何の副作用もない制御綴の終了が面倒くさくなる, よ. そうだったとしても^^@(NUL)とかのカテゴリーコード9の文字を使ってあげればいいけど, ね.P`あ～理解は出来ました.'広さて, これで簡単な例は終了だ, よ.P`あっ.'広じゃあ, ここでもう一回Listings リスト19.1を見てみよう.広1行目から3行目まではカテゴリーコードの定義だ, よ. TeXはもともとは殆どの文字のカテゴリーコードが12に割り振られているから, ちゃんと宣言してあげる必要がある, よ.広4行目と5行目は, カウンタの作成だ, よ.P`すみません, カウンタとは…… ?'広今回は, 数字を保存するためのものだと思っていい, よ.広6行目では, \m@neにを代入している, よ.P`なるほど'広そして, 先に14行目から説明していく, ね.P`何故です?'広そっちの方が, 説明がスムーズだ, よ. これは, 展開順序の関係もある, よP`ふむ.'広まず, 14行目の\uccodeについて. これは, 大文字を定義する, よ.P`といいますと?'広TeXには, \uppercaseというものがあって, これは引数として渡した文字列を, 可能なら大文字に変える, よ.P`ああ, 組版処理に特化した言語らしい指示ですね'広うん. それで, ね. ここではこれを悪用するよ.広グルーピングの仕様として, グローバルな定義をしたもの……\gdefとか以外は, その外側に影響しない.というものがある.広だから, ここで, 1の大文字をiにして, 2の大文字をfにしたとして, 他の部分には影響しない.P`ふむ.'広そして, TeXの\defには, パターンマッチ機能がある.P`と, いいますと?'広\defで定義した制御綴が引数を持つとき, その「かたち」を決めることが出来る, よ.P`ふむ'広例えば, \def\hoge#1bar#2{#2#1#2}としてあげて, \hoge foobar{baz}とすると, 出力結果はbazfoobazとなる.P`!?'広これは, 引数の形の定義に, barが含まれているから, hogeの後からbarまでの間が\#1だと見なされることによる.P`はええ……'広そして, さっきのnewifの14行目に戻ると, \if@というマクロがグローバルに定義されていて, このマクロは1, 2にパターンマッチをして, 空の文字列を返す, ね.P`そうなります, ね.'広そして, このグルーピングの中では1の大文字はi, 2の大文字はfで, \uppercaseが使われているから……?P`……あっ. \if@は, i,fにパターンマッチをして, 空の文字列を返す. ということですか?'広ぴんぽん. せいかい.P`なかなか面妖なことを……'広ふふ, そうだね.広それで, ね. 13行目は目新しいことをしているだけで, 14行目よりは簡単だ, よ.広ここで新しく出てくるのは\csname, \expandafter, \string, \endcsnameの三つだ, よ.P`ふむ……'広まず, \stringは簡単. 直後に来たものを, 文字としてそのまま扱う, よ.P`ああ, 例えば\LaTeXを, \LaTeXという制御綴ではなく, \LaTeXという文字列として扱うといったことですか?'広そうそう. それで, ね. \csnameも簡単. これは, ここから\endcsnameまでの間の文字列を名前に持つ制御綴としてふるまう, よ. もしもその制御綴が未定義なら, \relaxとしてふるまう, よ.P`とすると, \csname hoge\endcsnameとすると, \hogeという制御綴が定義されると言うことですか?'広そう. そういうこと. 最後に, \expandafterは, マクロの展開を1回後にする, よ.P`といいますと?'広今回の例だと, \expandafterが存在しないとすると, TeXは, まず\if@を解釈しようとする. すると, 直後の\stringはパターンマッチに合致しないから混乱してしまう, ね.P`はいはい.'広だから, ここで\expandafterをしてあげることで, \if@について考えることを一回お休みしてもらう, よ.P`ふむ.'広すると, 先にTeXは\stringについて考えるから, #1が\ifhogeの形だったら混乱しないで済む, よ.P`あ～なんとなくは理解できました.'広うん, それで, ね. ここからが問題.P`う, 嫌な予感.'広まずは7行目から. \outerは, この直後の\defで定義されたマクロは, 他のマクロの定義とか, マクロの引数に含めることは出来ない, よ.P`なるほど.'広そして, 次の\count@\escapecharというのは, ちょっと特殊なお話. さっきプロデューサーに\stringの話をしたけど, あれには少し嘘がある.P`と, いいますと?'広\stringにパターン2か3の制御綴を渡したとき, それがそのまま文字扱いされるわけではない, よ.P`ふむ?'広じつは, 受け取った制御綴の名前の部分(つまり, \を無視した部分)を取り出して, そこに\escapecharに保存されている文字番号に対応する文字を書き加える, という事をしている, よ.P`なるほど. ではデフォルトではバックスラッシュの文字番号が保存されているんですね.'広そういうこと. それで, ね. ここでは\count@に\escapecharの値を代入している, よ. TeXはカウンタ同士を並べると, を省略したものと見なす, よ.P`ひぇ.'広そして, 今度は\escapecharに\m@neつまりを代入する, よ. こうすると, \stringを使ったときに, 何も書き加えられなくなる, よ.P`ふむ.'広次は8行目. これは, ちゃんと考えれば分かる, よ.P`う～ん…… まず1つめの\expandafterが次のそれの評価を1回遅延して, 3個目のこれが, その次の\defの評価を1回遅延する. 2回目に評価するときは2個目だった\expandafterが残っているから, これがまた\defの評価を遅延する. ということですか?'広かんぺき. よくできました. つまり, 次に評価されるのは\@ifだ, ね.P`ああ, だから2回分遅延できる必要があったんですね?'広おP`そもそも\@ifの中で1回\expandafterが使われているから, \@ifが完全に評価されてから\defが評価されるためには, 二回\defを遅延する必要があった, と'広いいね. プロデューサーもTeX言語に慣れてきたみたい.広じゃあ, ちょっと\newifの使い方を思い返してみて. 因みに, \iftrueというのは, 常に真として扱われるif文だ, よ.P`ふむ…… \newifは\newif\ifhogeの形で利用できて, \ifhoge,\hogetrue,\hogefalseの三つが一気に定義される……'広そうそうP`とすると, 簡単のために\#1 は\ifhogeとすると, まず\@if#1{true}で\hogetrueという制御綴が生成されて, その後に\defによってその意味が\let\ifhoge=\iftrueとなると. ……すみません篠澤さん, \letとはなんですか?'広あ, ごめんプロデューサー. \let\hoge=\fugaは, \hogeの意味を\fugaにする制御綴だよ.P`ああ, とすると, \hogetrueをすると\ifhogeの意味が\iftrueになる, ということですね.'広あってるよ. プロデューサー.P`そして, falseについても同様, と. そして, 12行目で, デフォルトでは\ifhogeがfalseになるようにしてあげているわけですね.'広ぴんぽんぴんぽん. これである程度のTeX言語はプロデューサーは読める, よ.P`もう二度と読みたくはないですが.'広そっか. もっと難しい例とかもあったんだけど……P`遠慮しておきます'広じゃあこれでTeX言語の話はおしまいだ, よ.広ちなみに, ここら辺は普通の をする分にはやる必要は, 特に現在なら, ないし, そもそも\defとかは使うべきでもない, よP`では何故お話を……?'広プロデューサーにも, TeXのままならなさを知ってほしかった.P`まあ, 大分ままならないものではありましたが……'<h2>19.5　TeXっぽいことについて</h2>
P`う～ん……'広どうしたの, プロデューサー.P`ここまで聞いて思ったんですが, TeX以外の方法はないんでしょうか?'広Wordとかじゃダメなの?P`WordはWordでこう, 行間の調整とかが面倒くさいところがあって……それに数式を挟むのにはあまり向いていないですし.'広ふむ, それなら最近だといいものがある.P`なんでしょう?'広typst, だよ.P`なんですか, それは.'広最近出てきた組版エンジンだよ.P`でも面倒くさいんでしょう?'広TeXよりも, 文章を書くには簡単にできる, よまぁ, パッケージ開発はすこし面倒くさいんだけど, ね.P`インストールが面倒くさいとかもあるでしょうし……'広詳細は省くけど, ウェブ上WASMさまさまだねで, 仕上がりを見ながら編集ができる, よ.まあ, TeXもbusyTeXとかがあるから似たことは出来るんだけど, ね.P`!?'広日本語の組版もだんだん綺麗になってきているし, もしかすると今後学生のレポートの主流になるかも, ね.P`それは興味深いんですが…… 結局新しい言語を習得しなければいけないんでしょう?'広ふむ. それなら, vivliostyleというものもある, よ.P`というと?'広HTML/CSSを利用して組版を行うもの, だよ. どうしてもコーディングをする時には, TeXは難しいし, typstも詳しいTypst構文の知識が欲しくなるのに対して, vivliostyleのベースはHTML/CSSだから, かなり簡単にかけるのが利点.P`あの, 俺のコンピューター技能を買いかぶっていませんか.'広いまどき, 日本の高校生はみんな習ってるらしい, よ. わたしは知らないけど.P`まあ確かに, 今の高校生は情報が必修ですからね.'広むむ, それなら, Markdownは?P`mdはよく使いますが, 数式が書けないでしょう?'広じつはね, KaTeXというものがあって, これをMarkdownと組み合わせることで, 数式を簡単に書けるようになる, よ.P`ふむ, またTeXですか?'広あああ, プロデューサー待って. KaTeXはTeX記法が使えるけど, 数式の時だけだから難しくない, よまあ, \defのパターンマッチ機能が使えたり, 全部の文字がアクティブ文字扱いだから変なことが出来るけど, ね.P`それなら, 俺が新しい記法を覚えることは必須ではないわけですね. ふむ, それを簡単に使える方法ってありますか?'広……ないかも.P`じゃあ意味ないじゃないですか.'広じゃあ, プロデューサーはMDか, Wordで文書を書くといい.P`だからそれではあまりよくないと……'広うん, だから, ね. それを私がLaTeXに直すから, プロデューサーが見た目を気にする必要はない, よ.P`それでは篠澤さんの時間を取り過ぎてしまいます. ただでさえ, トレーニング不足なのに……'広私も, そこまで時間は使わない, よ.P`……はい?'広Pandocというものがあって, その辺の文書ファイルを大体全部, お互いに変換できる, よ. 勿論mdとdocsとtexも, ね.P`便利なものですね. ……俺がそれを使えるようになれば良いのでは?'広うん…… そうだけど, ね. P`だけど?'広プロデューサーが書く文章が読みたかった.P`はぁ…… そう言ってくれれば別に読ませますよ.'広だめ. だってそうしたらプロデューサー, そもそもレポートが存在すること自体を言わないでしょ?P`うっ.'広だから, ね.P`あーもう分かりました. そうしましょう.'広約束, ね.</aid:doc>